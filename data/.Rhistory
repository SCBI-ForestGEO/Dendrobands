dendro_2018$date <- paste0(dendro_2018$month, sep="/", dendro_2018$day, sep="/", dendro_2018$year)
View(dendro_2018)
band18 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2018.csv")
library(chron)
dendro_2018$date <- paste0(dendro_2018$month, sep="/", dendro_2018$day, sep="/", dendro_2018$year)
band18$doy <- julian(band18$month, band18$day, band18$year, origin=c(01,01,2018))
intra$date <- as.Date(intra$date, format="%m/%d/%Y")
intra$date <- factor(intra$date, ordered=TRUE)
band18$date <- factor(intra$date, ordered=TRUE)
band18$date <- as.Date(intra$date, format="%m/%d/%Y")
band18$date <- as.Date(band18$date, format="%m/%d/%Y")
band18$date <- paste0(band18$month, sep="/", band18$day, sep="/", band18$year)
band18$doy <- julian(band18$month, band18$day, band18$year, origin=c(01,01,2018))
band18$date <- as.Date(band18$date, format="%m/%d/%Y")
band18$date <- factor(band18$date, ordered=TRUE)
View(band18)
#2a. for-loop graphs ####
#this code makes graphs for every dendroband stemID
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(data = dendro) +
aes(x = date, y = dbh2, group=1) +
geom_line(color = "#0c4c8a") +
labs(title = paste0("Tree Growth from dendrobands 2011-2018 ",sep="_", j),
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
#2a. for-loop graphs ####
#this code makes graphs for every dendroband stemID
library(ggplot2)
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(data = dendro) +
aes(x = date, y = dbh2, group=1) +
geom_line(color = "#0c4c8a") +
labs(title = paste0("Tree Growth from dendrobands 2011-2018 ",sep="_", j),
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(data = dendro) +
aes(x = date, y = dbh2) +
geom_line(color = "#0c4c8a") +
labs(title = paste0("Tree Growth from dendrobands 2011-2018 ",sep="_", j),
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
dev.off()
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(data = dendro) +
aes(x = date, y = dbh2) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
?geom_path\
?geom_path
q <- ggplot(data = dendro) +
geom_path(aes(x = date, y = dbh2)) +
geom_path()
q <- ggplot(data = dendro) +
geom_path(aes(x = date, y = dbh2)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
q
q <- ggplot(data = dendro) +
geom_path(aes(x = date, y = dbh2)) +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
q
q <- ggplot(data = dendro) +
geom_path(aes(x = date, y = dbh2, group=1)) +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
q
ggplot(data = dendro) +
geom_path(aes(x = date, y = dbh2, group=1)) +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
q <- ggplot(data = dendro, aes(x = date, y = dbh2, group=1)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(data = dendro, aes(x = date, y = dbh2, group=1)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
print(q)
q <- ggplot() +
geom_path(dendro, aes(x = date, y = dbh2, group=1))
q <- ggplot() +
geom_path(dendro, aes(x = date, y = dbh2, group=1)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
q <- ggplot(dendro, aes(x = date, y = dbh2, group=1)) +
geom_path() +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(dendro, aes(x = date, y = dbh2, group=dbh2)) +
geom_path() +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
#dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(dendro, aes(x = date, y = dbh2, group=dbh2)) +
geom_path() +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
class(all_stems$stemID_8495)
class(all_stems$stemID_8495$dbh2)
class(all_stems$stemID_8495$date)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
class(all_stems$stemID_8495$date)
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
#dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(dendro, aes(x = date, y = dbh2, group=1)) +
geom_path() +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
#facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
q <- ggplot(dendro, aes(x = date, y = dbh2, group=1)) +
geom_path() +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
#facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
q <- ggplot(dendro, aes(x = date, y = dbh2, group=1)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
#facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
q <- ggplot(dendro, aes(x = date, y = dbh2, group=dbh2)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
#facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
dirs <- dir("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data", pattern="_201[1-8]*.csv")
years <- c(2011:2018)
#1a. this loop breaks up each year's dendroband trees into separate dataframes by stemID
all_years <- list()
for (k in seq(along=dirs)){
file <- dirs[[k]]
yr <- read.csv(file)
yr_intra <- yr[yr$intraannual==1, ]
all_years[[k]] <- split(yr_intra, yr_intra$stemID)
}
tent_name <- paste0("trees", sep="_", years)
names(all_years) <- tent_name
#the below loop takes all the unique stemIDs from each year and rbinds them.
all_stems <- list()
for(stemID in sort(unique(unlist(sapply(all_years, names))))) {
all_stems[[paste0("stemID_", stemID)]] <-  do.call(rbind, lapply(years, function(year) all_years[[paste0("trees", sep="_", year)]][[stemID]]))
}
#sort(unique(unlist(sapply(all_years, names)))) -> an explainer:
#sapply says find all the names within all_years
#unlist says take all those names (all those stemIDS) and dump them all together
#unique gets rid of the duplicates, and sort sorts them
#need to call in Condit's functions (also saved in separate R code) for the next bit
objectiveFuncDendro= function(diameter2,diameter1,gap1,gap2){
if(gap1>diameter1) return(20)
if(gap2>diameter2) return(20)
delta=abs(diameter1 - diameter2 + (1/pi) * diameter2 * asin(gap2/diameter2) - (1/pi) * diameter1 * asin(gap1/diameter1))
return(return(delta))
}
findOneDendroDBH= function(dbh1,m1,m2,func=objectiveFuncDendro){
if(is.na(dbh1)|is.na(m1)|is.na(m2)|dbh1<=0) return(NA)
if(m2>0) upper=dbh1+m2
else upper=dbh1+1
if(m2<m1) lower=0
else lower=dbh1
result=optimize(f=func,interval=c(lower,upper),diameter1=dbh1,gap1=m1,gap2=m2)
return(result$minimum)
}
findDendroDBH= function(dbh1,m1,m2,func=objectiveFuncDendro){
records=max(length(dbh1),length(m1),length(m2))
if(length(dbh1)==1) dbh1=rep(dbh1,records)
if(length(m1)==1) m1=rep(m1,records)
if(length(m2)==1) m2=rep(m2,records)
dbh2=numeric()
for(i in 1:records) dbh2[i]=findOneDendroDBH(dbh1[i],m1[i],m2[i],func)
return(dbh2)
}
#1b. this loop says the following:
##1. Assigns the first dbh of the growth column as the first dbh.
##2. Says if new.band=0 (no band change), use Condit's function to determine next dbh based on caliper measurement. If new.band=1 (band and measurement change) and the dbh in the original column is unchanged (indicating a new dbh wasn't recorded when the band was changed), then find the avg of the previous rows in the growth column and add to the previous dbh. Otherwise, if new.band=1 and the dbh in the original column was newly recorded, use Condit's function.
for(stems in names(all_stems)) {
tree.n <- all_stems[[stems]]
tree.n$dbh2 <- ""
for (i in 2:(nrow(tree.n))){
cal <- c(tree.n$measure)
tree.n$dbh2[[1]] <- tree.n$dbh[[1]]
tree.n$dbh2 <- as.numeric(tree.n$dbh2)
tree.n$dbh2[[i]] <- ifelse(tree.n$new.band[[i]] ==0,
findDendroDBH(tree.n$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(tree.n$dbh[[i]] == tree.n$dbh[[i-1]],
mean(diff(tree.n$dbh2[1:i-1])) + tree.n$dbh2[[i-1]],
findDendroDBH(tree.n$dbh2[[i-1]], cal[[i-1]], cal[[i]])))
}
all_stems[[stems]] <- tree.n
}
#2a. for-loop graphs ####
#this code makes graphs for every dendroband stemID
library(ggplot2)
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
#dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(dendro, aes(x = date, y = dbh2, group=dbh2)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal() +
#facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
pdf(file = "DBH_growth_Dendrobands.pdf")
for (j in names(all_stems)){
dendro <- all_stems[[j]]
dendro$date <- paste0(dendro$month, sep="/", dendro$day, sep="/", dendro$year)
dendro$date <- as.Date(dendro$date, format="%m/%d/%Y")
#dendro$date <- factor(dendro$date, ordered=TRUE)
#dendro$doy <- julian(dendro$month, dendro$day, dendro$year, origin=c(01,01,2018))
q <- ggplot(dendro, aes(x = date, y = dbh2, group=dbh2)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal()
#facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
}
q <- ggplot(dendro, aes(x = date, y = dbh2)) +
geom_line(color = "#0c4c8a") +
labs(title = "Tree Growth from Dendrobands 2011-2018",
x = "Date",
y = "DBH in mm") +
theme_minimal()
#facet_wrap(c("tag", "stemtag"), labeller="label_both")
print(q)
View(dendro)
test <- intra[intra$tag==10671, ] #10671 has band replaced but with NAs for a few measurements
######################################################################################
#1c. troubleshoot #####
dendro_2018 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2018.csv")
intra <- dendro_2018[dendro_2018$intraannual==1, ]
test <- intra[intra$tag==10671, ] #10671 has band replaced but with NAs for a few measurements
View(test)
dendro_2017 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2017.csv")
intra <- dendro_2017[dendro_2017$intraannual==1, ]
test <- intra[intra$tag==10671, ] #10671 has band replaced but with NAs for a few measurements
View(test)
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0,
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(test$dbh2[1:i-1])) + test$dbh2[[i-1]],
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]])))
}
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
test$db2[[i]],
ifelse(test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(test$dbh2[1:i-1])) + test$dbh2[[i-1]],
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]))))
}
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
is.na(test$db2[[i]]),
ifelse(test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(test$dbh2[1:i-1])) + test$dbh2[[i-1]],
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]))))
}
View(test)
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
is.na(test$db2[[i]]),
ifelse(test$new.band[[i]]==1 & test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(test$dbh2[1:i-1])) + test$dbh2[[i-1]],
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]))))
}
View(test)
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
is.na(test$db2[[i]]),
ifelse(test$new.band[[i]]==1 & test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(!is.na(test$dbh2[1:i-1]))) + test$dbh2[[i-1]],
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]))))
}
View(test)
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
is.na(test$db2[[i]]),
ifelse(test$new.band[[i]]==1 & test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(!is.na(test$dbh2[1:i-1]))) + !is.na(test$dbh2[[i-1]]),
findDendroDBH(!is.na(test$dbh2[[i-1]]), cal[[i-1]], cal[[i]]))))
}
View(test)
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
is.na(test$db2[[i]]),
ifelse(test$new.band[[i]]==1 & test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(test$dbh2[1:max(which(!is.na(test$dbh2)))]))) + max(which(!is.na(test$dbh2))),
findDendroDBH(max(which(!is.na(test$dbh2))), cal[[i-1]], cal[[i]])))
}
View(test)
library(zoo)
?na.locf
test$dbh2[[i]] <- na.locf(test$dbh2)
test$dbh2[i] <- na.locf(test$dbh2)
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
is.na(test$db2[[i]]),
#ifelse(test$new.band[[i]]==1 & test$dbh[[i]] == test$dbh[[i-1]],
#       ifelse(is.na(test$dbh2[1:i-1]),
#              mean(diff(test$dbh2[1:i-1]))) + (test$dbh2[[i-1]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]])))
}
i=7
test$dbh2[i] <- na.locf(test$dbh2)
?zoo
test$dbh2[i] <- na.locf(test$dbh2, na.rm=TRUE)
test$dbh2[i] <- na.locf(test$dbh2, fromLast=TRUE)
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
is.na(test$db2[[i]]),
ifelse(test$new.band[[i]]==1 & is.na(test$dbh2[[i-1]]) & test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(test$dbh2[1:max(which(!is.na(test$dbh2)))]))) + (max(which(!is.na(test$dbh2)))),
#ifelse(test$new.band[[i]]==1 & !is.na(test$dbh2[[i-1]]) & test$dbh[[i]] == test$dbh[[i-1]]),
#mean(diff(test$dbh2[1:i-1])) + test$dbh2[[i-1]],
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]])))
}
for (i in 2:nrow(test)){
cal <- c(test$measure)
test$dbh2[1] <- test$dbh[1]
test$dbh2[i] <- ifelse(test$new.band[[i]] ==0 & !is.na(test$measure[[i]]),
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]),
ifelse(test$new.band[[i]] == 0 & is.na(test$measure[[i]]),
is.na(test$db2[[i]]),
ifelse(test$new.band[[i]]==1 & is.na(test$dbh2[[i-1]]) & test$dbh[[i]] == test$dbh[[i-1]],
mean(diff(test$dbh2[1:max(which(!is.na(test$dbh2)))])) + (max(which(!is.na(test$dbh2)))),
#ifelse(test$new.band[[i]]==1 & !is.na(test$dbh2[[i-1]]) & test$dbh[[i]] == test$dbh[[i-1]]),
#mean(diff(test$dbh2[1:i-1])) + test$dbh2[[i-1]],
findDendroDBH(test$dbh2[[i-1]], cal[[i-1]], cal[[i]]))))
}
View(test)
which(!is.na(test$dbh2))
class(test$dbh2)
which(!is.na(test$dbh2), value=TRUE)
?which
which(!is.na(c(test$dbh2)), value=TRUE)
which(!is.na(c(test$dbh2)))
test$dbh2
NonNAindex <- which(!is.na(test$dbh2))
first <- min(NonNAindex)
first <- NonNAindex[1]
?na.trim
