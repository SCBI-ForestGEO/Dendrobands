#############################################################################
#4 determine the actual trees to replace ####
recensus2018 <- read.csv("I:/recensus2018.csv")
deadcodes <- c("[^D]")
alive <- recensus2018[!(recensus2018$Codes %in% deadcodes), ]
alive <- subset(recensus2018, !(recensus2018$Codes %in% deadcodes))
deadcodes <- c("[[^D.$]]")
alive <- subset(recensus2018, !(recensus2018$Codes %in% deadcodes))
deadcodes <- c("[[^D.+$]]")
alive <- subset(recensus2018, !(recensus2018$Codes %in% deadcodes))
alive <- subset(recensus2018, !(grepl("D", recensus2018$Codes)))
alive$Codes
levels(alive$Codes)
alive <- subset(recensus2018, !(grepl("[[^D.+$]]", recensus2018$Codes)))
alive <- subset(recensus2018, !(grepl("^D", recensus2018$Codes)))
alive$Codes
"D" %in% alive$Codes
alive <- subset(recensus2018, !(grepl("D", recensus2018$Codes)))
data_2019 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2019.csv")
install_late <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
View(install_late)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
data_2018 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2018.csv")
#subset by the most recent survey and live trees
data_2019 <- subset(data_2018,survey.ID=="2018.14" & status=="alive")
cols <- c("survey.ID", "year", "month", "day", "measure", "codes", "notes", "status", "field.recorders", "data.enter", "new.band")
data_2019[,cols] <- ""
write.csv(data_2019, "scbi.dendroAll_2019.csv", row.names=FALSE)
View(data_2019)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
data_2019 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2019.csv")
install_late <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
data_2019 <- rbind(data_2019, install_late)
data_2019 <- data_2019[order(data_2019$tag, data_2019$stemtag), ]
View(data_2019)
write.csv(data_2019, "scbi.dendroAll_2019.csv", row.names=FALSE)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
dendroID <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/dendroID.csv")
fix_data <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
setdiff(colnames(fix_data), colnames(dendroID))
extracols <- c(setdiff(colnames(fix_data), colnames(dendroID)))
fix_band <- fix_band[, -c(extracols)]
fix_band <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
fix_band <- fix_band[, -c(extracols)]
fix_band <- fix_band[, -extracols]
fix_band <- fix_band[, -c("lx", "ly", "year", "month", "day", "measure", "codes", "notes", "field.recorders", "data.enter", "status")]
fix_band <- subset(fix_band, select=-extracols)
fix_band <- subset(fix_band, select= -extracols)
fix_band <- subset(fix_band, select= -c("lx", "ly", "year", "month", "day", "measure", "codes", "notes", "field.recorders", "data.enter", "status"))
fix_band <- fix_band[, !c("lx", "ly", "year", "month", "day", "measure", "codes", "notes", "field.recorders", "data.enter", "status")]
fix_band <- fix_band[, !(names(fix_band) %in% extracols)]
dendroID <- rbind(dendroID, fix_band)
dendroID <- dendroID[order(dendroID$tag, dendroID$stemtag), ]
View(dendroID)
fix_band <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
fix_band$dbh <- fix_band$dbh*10
fix_band$dendDiam <- fix_band$dendDiam*10
View(fix_band)
getwd()
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms")
write.csv(fix_band, "data_entry_fix_replace_2019.csv")
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
dendroID <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/dendroID.csv")
fix_band <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
extracols <- c(setdiff(colnames(fix_data), colnames(dendroID)))
fix_band <- fix_band[, !(names(fix_band) %in% extracols)]
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
dendroID <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/dendroID.csv")
fix_band <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
extracols <- c(setdiff(colnames(fix_band), colnames(dendroID)))
fix_band <- fix_band[, !(names(fix_band) %in% extracols)]
dendroID <- if(dendroID$new.band==1) {rbind(dendroID, fix_band)}
fix_band <- fix_band[, !(fix_band$new.band==1)]
fix_band <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
extracols <- c(setdiff(colnames(fix_band), colnames(dendroID)))
fix_band <- fix_band[, !(names(fix_band) %in% extracols)]
fix_band <- fix_band[!(fix_band$new.band==1), ]
fix_band <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
extracols <- c(setdiff(colnames(fix_band), colnames(dendroID)))
fix_band <- fix_band[, !(names(fix_band) %in% extracols)]
fix_band <- fix_band[!(fix_band$new.band==0), ]
View(fix_band)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
data_2018 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2018.csv")
#subset by the most recent survey and live trees
data_2019 <- subset(data_2018,survey.ID=="2018.14" & status=="alive")
cols <- c("survey.ID", "year", "month", "day", "measure", "codes", "notes", "status", "field.recorders", "data.enter", "new.band")
data_2019[,cols] <- ""
write.csv(data_2019, "scbi.dendroAll_2019.csv", row.names=FALSE)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
data_2019 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2019.csv")
install_late <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
data_2019 <- rbind(data_2019, install_late)
data_2019 <- data_2019[order(data_2019$tag, data_2019$stemtag), ]
write.csv(data_2019, "scbi.dendroAll_2019.csv", row.names=FALSE)
setdff(colnames(install_late), colnames(data_2019))
setdiff(colnames(install_late), colnames(data_2019))
View(install_late)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
data_2019 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2019.csv")
install_late <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/resources/data_entry_forms/2019/data_entry_fix_replace_2019.csv")
data_2019 <- rbind(data_2019, install_late)
data_2019 <- data_2019[order(data_2019$tag, data_2019$stemtag), ]
write.csv(data_2019, "scbi.dendroAll_2019.csv", row.names=FALSE)
#1. update dendroID.csv ####
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
dendro2010 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2010.csv")
dendro2011 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2011.csv")
dendro2012 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2012.csv")
dendro2013 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2013.csv")
dendro2014 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2014.csv")
dendro2015 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2015.csv")
dendro2016 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2016.csv")
dendro2017 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2017.csv")
dendro2018 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2018.csv")
dendro2011 <- dendro2011[dendro2011$new.band==1, ]
dendro2012 <- dendro2012[dendro2012$new.band==1, ]
dendro2013 <- dendro2013[dendro2013$new.band==1, ]
dendro2014 <- dendro2014[dendro2014$new.band==1, ]
dendro2015 <- dendro2015[dendro2015$new.band==1, ]
dendro2016 <- dendro2016[dendro2016$new.band==1, ]
dendro2017 <- dendro2017[dendro2017$new.band==1, ]
dendro2018 <- dendro2018[dendro2018$new.band==1, ]
dendro2018 <- dendro2018[ , -17]
install <- rbind(dendro2010, dendro2011, dendro2012, dendro2013, dendro2014, dendro2015, dendro2016, dendro2017, dendro2018)
install <- install[ ,colnames(install) %in% c("tag", "stemtag", "sp", "quadrat", "stemID", "treeID", "biannual", "intraannual", "survey.ID", "dendDiam", "dbh", "new.band", "dendroID", "type", "dir", "dendHt", "crown.condition", "crown.illum", "lianas", "measureID")]
install <- install[order(install$tag, install$stemtag), ]
dendro_trees <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/dendro_trees.csv")
length(unique(install$stemID))
length(unique(dendro_trees$stemID))
setdiff(dendro_trees$stemID, install$stemID)
setdiff(colnames(dendro2017), colnames(dendro2018))
View(dendro2018)
dendro2010 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2010.csv")
dendro2011 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2011.csv")
dendro2012 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2012.csv")
dendro2013 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2013.csv")
dendro2014 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2014.csv")
dendro2015 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2015.csv")
dendro2016 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2016.csv")
dendro2017 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2017.csv")
dendro2018 <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data/scbi.dendroAll_2018.csv")
dendro2011 <- dendro2011[dendro2011$new.band==1, ]
dendro2012 <- dendro2012[dendro2012$new.band==1, ]
dendro2013 <- dendro2013[dendro2013$new.band==1, ]
dendro2014 <- dendro2014[dendro2014$new.band==1, ]
dendro2015 <- dendro2015[dendro2015$new.band==1, ]
dendro2016 <- dendro2016[dendro2016$new.band==1, ]
dendro2017 <- dendro2017[dendro2017$new.band==1, ]
dendro2018 <- dendro2018[dendro2018$new.band==1, ]
install <- rbind(dendro2010, dendro2011, dendro2012, dendro2013, dendro2014, dendro2015, dendro2016, dendro2017, dendro2018)
install <- install[ ,colnames(install) %in% c("tag", "stemtag", "sp", "quadrat", "stemID", "treeID", "biannual", "intraannual", "survey.ID", "dendDiam", "dbh", "new.band", "dendroID", "type", "dir", "dendHt", "crown.condition", "crown.illum", "lianas", "measureID")]
install <- install[order(install$tag, install$stemtag), ]
write.csv(install, "dendroID.csv", row.names=FALSE)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data")
dirs <- dir("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data", pattern="_201[1-8]*.csv")
years <- c(2011:2018)
all_years <- list()
for (k in seq(along=dirs)){
file <- dirs[[k]]
yr <- read.csv(file)
yr_intra <- yr[yr$intraannual==1, ]
tent_name <- paste0(years, sep="_", "trees")
#years[[j]] <- ifelse(dirs[[k]]=="scbi.dendroAll_2010.csv",
#split(yr, yr$stemID),
#split(yr_intra, yr_intra$stemID))
tent <- split(yr_intra, yr_intra$stemID)
all_years[[k]] <- tent
}
View(all_years)
names(all_years) <- tent_name
View(all_years)
dirs <- dir("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/Dendrobands/data", pattern="_201[1-8]*.csv")
library(data.table)
date <- c(2011:2018)
filename <- paste(date, "range", sep="_")
all_sp <- list()
all_files <- list()
#this nested for-loop first makes a list of each species' average growth (max-min) in a year. Then, it combines all the years into one list (all_files).
for (j in seq(along=dirs)){
year <- read.csv(dirs[[j]])
year$sp <- as.character(year$sp)
sp <- c(unique(year$sp))
for (i in seq(along=sp)){
spec <- sp[[i]]
name <- paste0(spec, "data")
sprange <- paste(sp[[i]], "range", sep="_")
name <- subset(year, sp %in% spec)
name <- name[ ,c("tag", "stemtag", "sp", "measure", "codes")]
#get range (max-min) of measurements by tag
sprange <- aggregate(name[, c("measure")], list(name$tag, name$stemtag, name$sp), FUN = function(i)max(i) - min(i))
colnames(sprange) <- c("tag", "stemtag", "sp", "growth")
#remove NA and values over 50 (would indicate band replacement)
sprange <- subset(sprange, !is.na(sprange$growth) & sprange$growth <= 50)
#take the average of the ranges
sprange <- if (nrow(sprange)>=2){
aggregate(sprange[, c("growth")], list(sprange$sp), mean)
}
else {
sprange[ ,c("sp", "growth")]
}
colnames(sprange) <- c("sp", paste0("avg_growth",date[j],"_mm"))
all_sp[[spec]] <- sprange
}
all_files[[j]] <- all_sp
}
View(all_files)
names(all_files) <- date
View(all_files)
