# Data tests for dendroband censuses

## Table of tests 

level | category | applied to | test  | warning (W) or error (E) | coded | requires field fix? | auto fix (when applicable)
----  | ---- | ----  | ----  | ---- | ---- | ---- | ---- 
plot | completion check | all trees in census | `measure` is recorded for all bands. If `NA`, `codes` field should contain `RE`. |  E | 2021 | Y | NA 
plot | completion check | all trees in census | `status` is recorded for all bands ("alive" or "dead"). |  E | 2021 | Y | NA 
plot | consistency check | all trees in census | `status` = "alive" or "dead" |  E | 2021 | N | NA 
band | consistency check | all bands in census | `survey.ID` = "year.[census number]", where census number is 2 digits and is 0.01 greater than min(year, max value for `survey.ID` across all bands) | E | 2021 | N | ?
band | consistency check | all bands in census | `year` is possible: between 2010-current year & is not `NA` | E | 2021 | N | ?
band | consistency check | all bands in census | `year` matches current year | W | not yet | N | ?
band | consistency check | all bands in census | `month` is possible: 1 ≤ `month` ≤ 12 & is not `NA` | E | 2021 | N | ?
band | consistency check | all bands in census | `month` matches current month | W | not yet | N | ?
band | consistency check | all bands in census | `day` is possible: 1 ≤ `day` ≤ 31 for Jan, 1 ≤ `day` ≤ 29 for Feb, ..., & is not `NA` | E | 2021 | N | ?
band | consistency check | all bands in census | `day` matches current day | W | not yet | N | ?
band | consistency check | all bands in census | `measure` is possible: 0 ≤ `measure` < 250 | E | 2021 | Y | NA
band | consistency check | all bands in census | `measure` is reasonable: abs(`measure` - previous `measure`) < 10 (*to start. We'll refine this.*) | E | 2021 | Y | NA
band | consistency check | all bands in census | if `measure` is not between 3 & **near limit of calipers**, `codes` includes "RE" | W | 2021 | N | add "RE" to codes **TODO**
band | consistency check | all bands in census | all `codes` are defined, separated with `;` or `,` or `:` | E | 2021 | sometimes | NA


## Set up instructions

Unlike when you set up testthat so that all tests are run as part of an
R package R CMD CHECK, we set up `testthat.R` so that it is just another
R script to be run in a `.github/workflows/*.yml` file:

```
    steps:
      ...
      - name: Run tests
        run: Rscript testthat.R
```

Accordingly

* the contents and location of the `testthat.R` file
* the structure of the directory that contains all tests 

differ than that of a true R package repository, for example when
generated by `usethis::use_testthat()`. See `?testthat::test_check()` ->
"R CMD CHECK" section and this
[PR](https://github.com/SCBI-ForestGEO/Dendrobands/pull/34#issuecomment-842561058)
for more details.